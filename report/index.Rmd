---
title: An Investegation of the Chicago Taxi Industry
author: Thomas G. J. Blomet, Daryna Bilodid, Yiren Cao, Olav Førland
output: 
  html_document:
    #code_folding: hide
    font-family: Times
bibliography: references.bib
nocite: "@*"
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(shiny.maxRequestSize=30*1024^2)
#options(shiny.maxRequestSize=30*1024^2)
#Naming the file index.Rmd and calling rsconnect::deployApp() posted the app succesfully on shiny server. 
#It created folder named rsconnect which contains two folders: documents and shinyapps.io
```

```{r Olav: Include packages and workspace, include=FALSE, eval=TRUE}

library(bibtex)
library(tidyverse)
library(sf)
library(leaflet)
library(ggmap)
library(mapview)
library(rgdal)
library(RColorBrewer)
library(janitor)
library(lubridate)
library(boot)
library(ggplot2)
library(gganimate)
library(gifski)
library(data.table)
library(readr)
library(qqplotr)
library(GGally)
library(raster)
library(spData)
library(spDataLarge)
library(tmap)
library(osmdata)
library(jsonlite)
library(zoo)
library(gganimate)
library(plotly)
library(knitr)
library(rmarkdown)
library(shiny)
library(plotly)
library(reshape2)
library(shinyWidgets)

load("./olav_used_files/data/companies_time_workspace.RData")
load("./daryna/glob.RData")


```

```{r Prepare chicago map, include=FALSE, eval=TRUE}
#Register API key to google
register_google(key="AIzaSyBT6yzDKV_DGcFGK9E-cXu0zNUD4WTJOZA")
            
#Get location of chicago
chicago <- geocode("Chicago, IL")

#Make leaflet map with chicago center -> make sure the maps are calculated at runtime
chicago_leaflet <- leaflet() %>% 
  setView(lng=chicago$lon, lat=chicago$lat, zoom=10) %>%
  addProviderTiles(providers$CartoDB.Positron) 
```


## Background and purpose of report
Since Uber and other ride-hailing applications were introduced, the taxi industry has been under massive pressure. This has put many drivers and taxi companies in a tough economic position. In 2015 the Chicago taxi industry even claimed that Uber and Lyft had reduced their business by 30-40% during that summer [@aaroncynic]. Due to such developments in the industry, there are many solid analyses of the state of the taxi industry. For example, @8887602 gives an in-depth analysis of how driving patterns affect drivers income in China, and builds a decision model to optimize their revenue. More closely to our data set, @Schneider gives an interesting comparison of the developments in Chicago and New York, in addition to indicating which areas seem most profitable in Chicago. 

To build on such analysis we have gathered data of all taxi trips made in Chicago in the period 2013 - 2020. This data is collected from Chicago Data Portal, and can be found [here](https://data.cityofchicago.org/Transportation/Taxi-Trips/wrvz-psew) [@taxi_trips]. In addition, we use [this](https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Community-Areas-current-/cauq-8yn6) data set from Chicago Data Portal to draw each area on the maps [@chicago_borders]. To explore relationships with outside factors such as population and living standard in each area, we have collected population-based data from Chicago Data Portal. These include [hardship data](https://data.cityofchicago.org/Health-Human-Services/Hardship-Index/5kdt-irec) [@hardship_index] and [wikidata](https://en.wikipedia.org/wiki/Community_areas_in_Chicago) for each area [@wikidata]. We have acquired data from 
In addition, we include [Transportation Network Providers - Trips](https://data.cityofchicago.org/Transportation/Transportation-Network-Providers-Trips/m6dm-c72p/data) for the trips information given by three licensed Transportation Network Providers in Chicago: Uber, Lyft, and Via [@ridehailing_chicago]. The exact contents of these data sets will be explained below. 

Based on these data sets, the goal of this project is to visualize the big trends in the Chicago taxi industry and view these trends in the context of external factors. We finally look at how these developments have affected the various companies.


This translates to three questions:

* How has the ride-hailing industry affected the development of the taxi industry in Chicago?
* How has this affected the different communities of Chicago?
* How has this affected the different companies?


## Metadata

**Taxi_Trips.csv** - *197,917,331* entries

* `trip_start_timestamp`: Character representation of when the trip started on the format **MM/DD/YYYY hh:mm:ss**. Rounded to the nearest 15 minutes
* `trip_seconds`: Numeric representation of the time of the trip in seconds
* `pickup_community_area`: Discrete integer uniquely defining in which Community Area the trip began
* `trip_total`: Numeric value indicating the total cost of the trip, in USD

**TNP.csv** - *215,037,932* entries

* `trip_start_timestamp`: Character representation of when the trip started on the format **MM/DD/YYYY hh:mm:ss**. Rounded to the nearest 15 minutes
* `pickup_community_area`: Discrete integer uniquely defining in which Community Area the trip began
* `trip_total`: Numeric value indicating the total cost of the trip, in USD

**Chicago_Community_Areas.shp** - *77* entries

* `geometry`: MultiPolygon object. Essentially a list of coordinates representing the borders of each area
* `area_num_1`: Discrete integer uniquely defining each Community Area. Corresponds to `pickup_community_area` and `dropoff_community_area` in *Taxi_Trips.csv*
*`community_name`: Character variable representing the name of each Community Area

**wiki.csv** - *77* entries

* `no.`: Equivalent to `area_num_1`
* `population`: Numeric representation of the population of each zone
* `area`: Numeric representation of the area of each zone, in $km^{2}$
* `density`: Numeric representation of the density of each zone, in $km^{2}$

**Per_Capita_Income.csv** - *78* entries

* `community_area_number`: Equivalent to `area_num_1`
* `percent_of_housing_crowded`: Numeric representation of the percent of occupied housing units with more than one person per room
* `percent_households_below_poverty`: Numeric representation of the percent of households living below the federal poverty level
* `percent_aged_16_unemployed`: Numeric representation of the percent of people aged 16 years or older in the labor force that are unemployed
* `percent_aged_25_without_high_school_diploma`: Numeric representation of the percent of people aged 25 years or older without a high school diploma
* `percent_aged_under_18_or_over_64`: Numeric representation of the percent of the population under 18 or over 64 years of age
* `per_capita_income`: Numeric representation of income per capita
* `hardship_index`: Combination of the variables above, details of which can be found [here](https://data.cityofchicago.org/Health-Human-Services/Hardship-Index/5kdt-irec)



## Approach

We start by exploring the data. This includes getting an overview of different time series, exploring trends and generally looking for differences between areas, companies and points in time.

After exploring our data, we will try to explain our findings by comparing them with outside data. We will subsequently look at how the developments uncovered have affected the taxi companies operating in the area, and finally, try to draw some general conclusions for the future of the taxi industry in Chicago.

Throughout this report, we will combine *OpenStreetMap*, *ggplot2*, *leaflet* and *sf* libraries to construct interactive maps. These interactive maps are made available through the use of *Shiny*. Such visualizations enable a dynamic and intuitive overview of how basic statistics are distributed over different variables. It also gives the reader the opportunity to display only what is of interest. We have also constructed animation with the *gganimate* library, which seamlessly incorporates time as an extra dimension in each plot.

To meet different user needs, we provide interactive shiny apps that allow users to obtain information of personal interest on their own. The reader is encouraged to explore these functionalities. 


```{r Yiren load and format data, include = FALSE}
load("yiren/yiren_total_count.RData")
df_total_count <- df_total_count %>% mutate(count = as.numeric(count), date = ym) %>% dplyr::select(-ym)
```

```{r Data function1, echo=FALSE, warning=FALSE, include=FALSE}
data_selection <- function(df_total_count, zone){
  my_data <- df_total_count %>%
    filter(pickup_community_area %in% zone)

  trip_zone <- my_data %>%
    mutate(community = pickup_community_area) %>%
    dplyr::select(date, trip_total, count, community) %>%

    group_by(date, community) %>%

    summarise(taxi_revenue = sum(trip_total), number_of_trips = sum(count), average_revenue = taxi_revenue/number_of_trips) # add avg


  return(trip_zone)
}

```

```{r Plot zones, include=FALSE}
plot_zone <- function(df_total_count, zone, choice){
  # parse zone
  new_zones <- c()
  for (single_zone in zone){
    zone_num <- strsplit(single_zone, ",")[[1]][1]
    new_zones <- c(new_zones, zone_num)
  }
  # print(new_zones)


  #parse choice
  if (choice == "trip_total") {
    p <- ggplot(data = data_selection(df_total_count, new_zones),
              aes(x = date, y = taxi_revenue,
                  colour = community))
  } else if (choice == "count") {
    p <- ggplot(data = data_selection(df_total_count, new_zones),
              aes(x = date, y = number_of_trips,
                  colour = community))
  } else {
    p <- ggplot(data = data_selection(df_total_count, new_zones),
              aes(x = date, y = average_revenue,
                  colour = community))
  }
   p <- p + geom_line(size=0.4) +

    labs(x = "Date", y = "Number of Taxi Trips")  +
    scale_y_continuous(n.breaks = 10,
                       expand = expansion(mult = c(.02, .02))) +
    theme(axis.text.x = element_text(angle = 45)) +
     ggtitle(zone)

  p <- ggplotly(p)
  return(p)
}

```

```{r Define ui, include = FALSE}
# Defining the UI
ui <- fluidPage(

  sidebarPanel(
    selectInput("choice", label = "Options: ",
              choices = c("trip_total", "count", "average"), selected = "count"),

    selectInput("zone", label = "Select Zone: ",
              choices = c('1, Rogers Park', '2, West Ridge', '3, Uptown', '4, Lincoln Square', '5, North Center', '6, Lake View', '7, Lincoln Park', '8, Near North Side', '9, Edison Park', '10, Norwood Park', '11, Jefferson Park', '12, Forest Glen', '13, North Park', '14, Albany Park', '15, Portage Park', '16, Irving Park', '17, Dunning', '18, Montclare', '19, Belmont Cragin', '20, Hermosa', '21, Avondale', '22, Logan Square', '23, Humboldt Park', '24, West Town', '25, Austin', '26, West Garfield Park', '27, East Garfield Park', '28, Near West Side', '29, North Lawndale', '30, South Lawndale', '31, Lower West Side', '32, The Loop', '33, Near South Side', '34, Armour Square', '35, Douglas', '36, Oakland', '37, Fuller Park', '38, Grand Boulevard', '39, Kenwood', '40, Washington Park', '41, Hyde Park', '42, Woodlawn', '43, South Shore', '44, Chatham', '45, Avalon Park', '46, South Chicago', '47, Burnside', '48, Calumet Heights', '49, Roseland', '50, Pullman', '51, South Deering', '52, East Side', '53, West Pullman', '54, Riverdale', '55, Hegewisch', '56, Garfield Ridge', '57, Archer Heights', '58, Brighton Park', '59, McKinley Park', '60, Bridgeport', '61, New City', '62, West Elsdon', '63, Gage Park', '64, Clearing', '65, West Lawn', '66, Chicago Lawn', '67, West Englewood', '68, Englewood', '69, Greater Grand Crossing', '70, Ashburn', '71, Auburn Gresham', '72, Beverly', '73, Washington Heights', '74, Mount Greenwood', '75, Morgan Park', "76, O'Hare Airport", '77, Edgewater'), selected = c('6, Lake View', '7, Lincoln Park','28, Near West Side'), multiple = TRUE)
  ),

  # Main panel for displaying outputs
  mainPanel(
    plotlyOutput("plot")
  )
)
```

```{r Yiren server, echo=FALSE}
# Defining the server
server = function(input, output) {
  output$plot <- renderPlotly(plot_zone(df_total_count, input$zone, input$choice))
}
```


## What is going on in the Chicago taxi industry?

We started this report by noting that there are many articles and analyses describing the decay of the taxi industry. To see how such claims coincides with the taxi industry in Chicago, we start by looking at how the earnings have developed throughout the years.
We calculate the total revenue as the sum of all trips for which the company of the taxi, the start time and the revenue of the trip had been recorded. There is the possibility to visualize it by days (the sum for each day), by month (the sum for each month), or by year (the sum for each year).


```{r Yiren revenue & activity, echo = FALSE, warning = FALSE, message = FALSE, out.width="100%"}
load("yiren/simple plots.RData")

sum_year = sum_year %>% mutate(date = ym) %>% select(-ym)
count_year = count_year %>% mutate(date = ym, count = trip_total) %>% select(-ym)

# ggplotly(sum_year %>% ggplot(aes(x = date , y=trip_total)) + geom_point() + geom_line() + ggtitle("Total Revenue of Taxi Trips"))
# ggplotly(count_year %>% ggplot(aes(x = date , y=count)) + geom_point() + geom_line() + ggtitle("Number of Taxi Trips"))

knitr::include_app("https://uberlu.shinyapps.io/time_series_dmy/", height = "600px")

```


It is clear that there is a trend downwards for the taxi industry in Chicago. The data shows a significant downward slope up to 2020. The smoothed model, therefore, works as a good tool to model the data in the years prior to 2020, but it is not descriptive of more recent years. As can be seen, the model is very sensitive to outliers, which early 2020 proved to be. By viewing day summation and zooming in at 2020, we can see that the drop starts around the 10th of march. The state of Illinois recorded their first case of Covid-19 on January 24th, and roughly two months later the governor declared lockdown @thomas. As this greatly restricted people's movements, it is natural to assume that this caused the great fall in taxi activity in early 2020. This dramatic fall causes the model to depict values ~ 0 for revenue in 2021 and onwards. This obviously doesn't make sense, and we should be careful to draw conclusions based on the model.


To visualize the differences in earnings between each year, we can group the plot above by year, and make it possible to aggregate the trip total over either day or month.

```{r Thomas Year Comparison, echo=FALSE, out.width="100%"}
knitr::include_app("https://uberlu.shinyapps.io/time_series_comparison/", height = "600px")
```

Visualizing by months, we see that generally, the months from June to October have the higher revenue. In addition, the monthly total revenue seems to behave similarly between each year. It is globally increasing from January to June and then decreasing from October to December.

Furthermore, it seems like the daily revenue has had the same up and down pattern over the years. It usually drops at the beginning of July, which is visible when looking at all the years. Note that the 4 July is Independence Day, which is a federal holiday in the United States. On such a day it is natural that taxi activity decreases as seen in the plot. We also see that revenue generally oscillates by \$ 200'000 to \$ 400'000 between days, which for some days correspond to a change of approximately 30%!

More interestingly, the taxi industry seems to peak in 2014. As mentioned earlier, the Chicago taxi industry actually claimed that Uber and Lyft had, only over the summer of 2015, reduced their market share by 30-40 %. To investigate this claim, we start by depicting the total revenue of ride-hailing companies in the US. Although not entirely accurate for the Chicago market, we believe the overall trend in the US will indicate the trend in Chicago as well. 


## Relationship between taxi trips and ride-hailing trips



```{r, echo = FALSE, warning = FALSE, message = FALSE}

# Source: https://www.businessofapps.com/data/taxi-app-market/
years = 2015:2020
revenue = c(3.7, 7.2, 9.9, 12.3, 14.7, 5.1)
us_taxi = data.frame(years, revenue)

ggplotly(us_taxi %>% ggplot(aes(x = years, y = revenue)) + geom_bar(stat="identity") + ggtitle("US Ridehailing Revenue") + ylab("Total Revenue ($bn)"))


```


From the years we have data, it is clear that as the revenue of the ride-hailing industry has increased, the revenue of the regular taxi industry has decreased. Therefore, US ride-hailing revenue might be a good explanation of why the year 2015 constitutes the zenith of the regular taxi industry. However as explained above, we would need data from Chicago to be able to draw a valid picture. Another problem is that the data above is aggregated over each year. This might lead to the loss of important processes in the system, and we should thus be careful about drawing conclusions [@clark1976effects].


We, therefore, searched for data about ride-hailing companies in Chicago and eventually obtained what we were looking for from *Transportation Network Providers* [@ridehailing_chicago]. However, a downside is that the data set only contains data starting November 2018. Therefore we will not be able to address the claim made by the Chicago Taxi Industry discussed above. It will, however, be interesting to view the relationship between the taxi and ride-hailing industry in recent years. Moreover, the data set is updated continuously, where the latest records are from September 2021. To guarantee that we only consider months where all records are registered, we view the data set from November 2018 to August 2021.

```{r, echo = FALSE}
knitr::include_graphics("./yiren/new_transition1.gif")
```
In the animation, *share_count* indicates the number of trips in Chicago from the ride-sharing companies Uber, Lyft, and Via, while *taxi_count* gives the number of normal taxi trips in Chicago.

In contrary to initial belief, the animation depicts a rather *stable* relationship between the taxi industry and the ride-hailing industry in Chicago. It is clear that the ride-hailing industry has a much bigger market share than the taxi industry in 2018, but they appear to change similarly. The significant event in the plot is the strike of the pandemic in early 2020, which hits both industries hard. As time passes from this event, both industries recover gradually. The ride-hailing industry seems however to adjust much better to the changes post-pandemic, and as a result, is increasing its market share relative to pre-pandemic. 


Regardless of the pandemic, it is clear that the taxi industry in Chicago at large is on a downwards trend. Nonetheless, the association between the years and revenue might be totally different when dividing our data into subgroups by area. This is well known as the *Simpsons paradox*, which might lead the picture to be totally different when considering each area separately [@sprenger2021simpson]. With this in mind, we will now consider the development in each *area.*


## How does this development translate to each zone?


We start by taking a slightly different view than above. To get an indication of how the activity, i.e. numbers of trips, have been distributed over the areas, we count all trips in each area. This yields a distribution very similar to the one uncovered in [our first project](https://yirencao.github.io/).


### Total number of taxi trips since 2013

```{r Map of activity, echo = FALSE, warning = FALSE, message = FALSE}

load("yiren/yiren_total_count_polygon_leaflet.RData")

pal1 <- colorBin("Oranges",bins=4, domain =log10(zone_total_count$total_count), )

labels <- sprintf(
  "<em>%s</em> <strong>%s</strong><br/>%s trips",
  zone_total_count$pickup_community_area, zone_total_count$community_name,
  prettyNum(zone_total_count$total_count, big.mark = ",")
) %>% lapply(htmltools::HTML)

#Make the map
chicago_leaflet %>%
  addPolygons(data=zone_total_count,
              fillColor=~pal1(log10(zone_total_count$total_count)),
              color="lightgrey",
              weight=2,
              fillOpacity=0.8,
              highlightOptions = highlightOptions(
                weight=3,
                opacity=2,
                color="Oranges",
                bringToFront=TRUE),
              label=labels,
              labelOptions=labelOptions(
                style = list("font-weight" = "normal", padding = "3px 8px"),
                textsize = "15px",
                direction = "auto")) %>%

  addLegend("bottomright",
            pal = pal1,
            values = log10(zone_total_count$total_count),
            title = "Total Number of Taxi Trips Since 2013",
            opacity = 0.8,
            labFormat = leaflet::labelFormat(
              transform = function(x) 10^(x)))

```

The majority of the trips are concentrated in a few areas; the airport *O'Hare* and the central areas *Loop*, *Near West Side* and *Near North Side*. O'Hare is located northwest of the central areas on the map. Although the map gives a nice overview of the distribution of revenue over areas, it does not address the aggregation problem presented above. The following figure lets the reader explore how each area has developed throughout the time period with respect to either revenue (*trip_total*), activity (*count*) or average revenue per taxi trip (*average*). Because of the skewed distribution shown above, we view the three most active areas by default. This can be manually changed to view different areas as well.


```{r shinyApp1, echo=FALSE, warning=FALSE}
#Use this after introduction, so that the reader is "invited" to explore more on his own
shinyApp(ui = ui, server = server)
```


When viewing the different areas, most share the same characteristic as Chicago as a whole - decreasing taxi activity. On the plot, we spot community *8, Near North Side* has the highest taxi trips with the largest fluctuation throughout the time. Community *28, Near West Side* has the lowest trips with the smallest fluctuation, and community *32, The Loop* lies somewhere in between. The differences between these areas are significant, but not on several orders of magnitude.  

Since the differences between the areas are so big, we are interested in uncovering underlying factors which might explain the differences. We will in the next section utilize several area-specific variables to investigate this. 

### PCA and Clustering to explain the differences between areas

To model the differences between areas we start by using *Principle Component Analysis* (PCA) as described in the [Stony Brook University Lecture Slides](https://www3.cs.stonybrook.edu/~mueller/teaching/cse564/Lec%2017%20-%20Principal%20Component%20Analysis.pdf) [@pca_lecture]. To fulfil the assumptions of PCA, we assume our data set to be a linear combination of the data variables. We can then use PCA to reduce the dimension of our outside data set. `per_capita_income`, `density`, `Population` and `hardship_index` from Per_Capita_Income.csv dataset are used.  In addition, this yields the classification power of our data. We apply the logarithm onto `count_taxi_trips` and get `log_count`, because `count_taxi_trips` will otherwise dominate all other variables. To classify zones based on the result, we apply k-means clustering.


```{r Clustering, echo = FALSE}
knitr::include_graphics("./yiren/5.png")
```

Since `per_capita_income` and `Population` are components with a larger variance while `log_count` is of our interest, we focus on the 3 variables in the following interpretation.


<em>&#8544;: Red cluster - high income per capita, large population and large log_count<br>
&#8545;: Blue cluster - high income per capita, small population and middle log_count<br>
&#8546;: Purple cluster - low income per capita, large population and middle log_count<br>
&#8547;: Green cluster - low income per capita, small population and small log_count</em>

Which we now can naturally map to each area:


```{r Clustering on map, echo = FALSE, warning = FALSE, message = FALSE}
load("yiren/df_temp_cluster.RData")

cluster = zone_total_count %>% inner_join(df_temp, by = "pickup_community_area")

pal2 <- colorBin(c("#ff6357", "#57baf4", "#7ed100", "#966fd6"),bins=c(1,2,3,4,5), domain =cluster$cluster) # red, blue, green, purple

labels <- sprintf(
  "%s <strong>%s</strong><br/>cluster %d",
  cluster$pickup_community_area, cluster$community_name, cluster$cluster
) %>% lapply(htmltools::HTML)

legend_label <- c("1.Red Cluster ", "2.Blue Cluster", "3.Purple Cluster", "4.Green Cluster")

#

#Make the map
chicago_leaflet %>%
  addPolygons(data=cluster,
              fillColor=~pal2(cluster),
              color="lightgrey",
              weight=2,
              fillOpacity=0.8,
              highlightOptions = highlightOptions(
                weight=3,
                opacity=2,
                color="Oranges",
                bringToFront=TRUE),
              label=labels,
              labelOptions=labelOptions(
                style = list("font-weight" = "normal", padding = "3px 8px"),
                textsize = "15px",
                direction = "auto")) %>%

  addLegend("bottomright",
            pal = pal2,
            values = cluster,
            title = "K-means Clustering",
            opacity = 0.8,
            # labFormat = leaflet::labelFormat(
            #   transform = function(x) (x)))
            labFormat = function(type, cuts, p) {
              paste0(legend_label)
            })

```

Interestingly, the central zones which we previously classified to be the top earners, all are located in different clusters. This indicates that there are multiple reasons behind high taxi trips. For example, the high amount of taxi trips in *O'Hare* might be related to factors that are not included in PCA, likely caused by the airport. Moreover, the *Near North Side* might have many taxi trips due to its high per capita income and high population, while *The Loop* might have a lot of activity due to the fact that it is the main business area in Chicago.



## What are the affects on the companies?

In the light of the above, the Chicago Taxi industry is under great pressure. When the demand for standard taxis decreases one would think that the amounts of companies would decrease as well. Perhaps a few of the companies capture all the customers, or maybe the customers will be equally split among the remaining? We will start this investigation by looking at how the amount of active taxi companies has changed over the period and supply a pie chart showing the aggregated market share of each company. We will loosely define market share as each company's revenue divided by the total revenue accumulated in the industry. This gives an intuitive overview of the distribution in the period, even though you probably can find more complex and correct definitions of market share elsewhere. For visual purposes, we only show the 10 biggest companies and aggregate all others.

```{r Company count, echo=FALSE}


#knitr::include_graphics("./companies.png")
knitr::include_graphics("./number_of_companies.png")
knitr::include_graphics("./company_market_share.png")
```

As we can see the number of different active taxi companies peaked around 2014, which as seen earlier was the most profitable time for taxi companies in Chicago. After 2014 the amounts of companies follow a very similar trend as the industry as a whole. It drops through most of 2015 but reaches a new local maximum some months into 2016. After this, the number of active taxi companies drops continuously until around 2018 when the curve starts to flatten out.

To indicate the relative size of each company throughout the period, we will consider the revenue of the seven biggest companies. The following animation shows the seven companies with the biggest revenue in each month throughout the time period.

```{r Market share, echo=FALSE}
options(shiny.maxRequestSize = 30*1024^2)
shiny::shinyOptions(shiny.maxRequestSize = 30*1024^2)
knitr::include_graphics("company_revenue.gif")
```

Although many of the biggest companies, e.g. *Taxi Affiliation Service* and *Flash Cab*, have remained stable top earners throughout the years, the relationship between the companies seems to change a visible amount. It looks as though the market transitions from being dominated by a few very large actors, to being more equally split between the biggest companies. This development abruptly stops when Covid-19 strikes, where Flash Cab and Taxi Affiliation Service managed the situation the best. As a result, they captured almost the entire market. However, by the little time that passed after the start of 2020, it looks as though the relationships starts to flatten out again. 

If the reader is interested, the following plot allows for a more in-depth comparison between individual companies in the time period. Here you will be able to visualize the total revenue per day, month or year for the thirty companies that made the most revenue between 2013 and 2021. 


```{r Thomas, include=FALSE, eval=TRUE}
knitr::include_app("https://uberlu.shinyapps.io/time_series_companies/", height=600)
```

We note that the analysis of companies might be affected by the possibility that some of the taxi companies might have switched names during the period. We have not focused on uncovering this, and have rather been more interested in the overall trends.


## Summary and future work

With the rise of ride-hailing, the traditional taxi industry has declined. The first signal showed up in 2015, where the market share of ride-hailing started rising. Although the trend for traditional taxis once again was on the in 2016, its development from that point has paled in comparison to the ride-hailing industry. Finally, the ride-hailing industry occupies most of the market today.

Our data is insufficient to assess the causality between the development of the two industries since the arrival of ride-hailing applications. Firstly, the data set of total ride-hailing revenue in the US is insufficient due to it incorporating data from the whole of the US and being aggregated by year. Secondly, the data set of the ride-hailing industry in Chicago is insufficient due to it only containing entries from late 2018 until today. The data did, however, indicate that the Chicago taxi and ride-hailing industry had reached a market equilibrium, i.e. a stable position. This abruptly came to an end when Covid-19 struck in 2020, and it seems like the ride-hailing industry is handling the situation best. 

When assessing the individual community areas of Chicago, it is clear that the number of taxi trips is unevenly distributed. Despite most of the areas sharing a similar, declining trend as the industry at large, there is still a non-negligible difference among areas. In addition, we saw that this could be a result of many different factors. By PCA and Clustering, many of the high-activity areas were associated with population and per capita income. On the other hand,  few of the most active areas ended up in the same cluster. Furthermore, the analysis does not explain the high trip count in O’hare either. This indicates that there are several factors that determine amounts of trips in each area, many of which we haven't considered. 

Furthermore, the decline of the taxi industry leads to a decrease in the number of active companies. Interestingly though, this seems to have resulted in an equally distributed marked shared among the biggest companies. With the strike of Covid-19, *Taxi Affiliation Service* and *Flash Cab* suddenly captured close to the whole market. However, this market position appeared to quickly even out as the general activity level increased.

Although the taxi industry and ride-hailing industry seemingly were at equilibrium in 2018, the ride-hailing industry is once again taking market shares from the taxi industry post-pandemic. To mitigate this development, we can in future work consider more factors to explain differences between areas. By getting a more holistic picture, we could possibly build a predictive model based on the developments in these factors. This could possibly help taxi companies know which areas they should focus on.

Due to the limit of time and the current data sets, we have not yet uncovered the entire story between the taxi and ride-hailing industries. We are particularly interested in how the competition started, evolved and how it possibly will end. What we can consider is the factors behind share riding becoming mainstream, and how the taxi industry can learn from these factors. To address this we might focus on one of the major ride-hailing providers Uber, and try to figure out the reason why it wins customers. Relevant features are prices, service quality, safety and information transparency. We could from that train a predictive model so that the taxi industry can do more of the right things. 

Moreover, with more public data, we would like to look at places more than Chicago and expect similar progress of share riding taxis to be found on a greater scale, such as in Europe. 

In addition to the share riding business, some other sharing economies also have had a growing trend throughout the years. A great example is the shared housing company Airbnb, which has risen in a similar fashion as Uber. Thus we want to delve deeper into similar industries and expand our story to the general sharing economy.





## Bibliography












